(
with trans as
(
SELECT sod.trans_date
, sod.increment_id
, sod.sku
, case when lower(sod.sku) like '%custom%' or lower(sod.sku) like '%civil%' or lower(sod.sku) like '%work%' then 'Custom'
       else sod.product_type end as product_type
, sod.nmv
, sod.cost_price
, sod.price_per_item
, sod.qty_ordered
, (sod.qty_ordered * sod.actual_price) GMV
, (sod.qty_ordered * sod.cost_price) COGS
, case when sos.customer_name like '%1675%' then 'hbf-1675'
       when sos.customer_name like 'Pbf 1603 widian' then 'pbf-1603 widian'
       when sos.customer_name like 'pbf retno' then 'pbf-1800'
       when sos.customer_name like 'pbf PT.PGAS Solution' then 'pbf-1898'
       when sos.customer_name like 'hbf-1415 rayhan' then 'pbf-1415 rayhan'
       when sos.customer_name like 'PBF 1909 PT. Parama Putra Mas Mandiri' then 'pbf-1909 PT. Parama Putra Mas Mandiri'
       when sos.customer_name like 'HBF-708 FRANS (EKSEKUTIF ROOM)' then 'pbf-708 FRANS (EKSEKUTIF ROOM)'
       when sos.customer_name like 'PBF=1857 Janji Jiwa' then 'pbf-1857 Janji Jiwa'
       when sos.customer_name like 'PNF-1675-565 REINALDI EKA Oshop' then 'pbf-1675-565 REINALDI EKA Oshop'
       when sos.customer_name like 'pf-1824 skandinavian apartment (1 bedroom)' then 'pbf-1824 skandinavian apartment (1 bedroom)'
       when sos.customer_name like 'db-218 roommie' then 'pbf-218 roommie'
       when sos.customer_name like 'FP Samsung' then 'FP-2071 Samsung'
       when sos.customer_name like 'fp samsung' then 'FP-2071 Samsung'
       when sos.customer_name like 'fp po pasar jaya' then 'fp-1792 po pasar'
       when sos.customer_name like 'fp PT ardaya' then 'fp-2072 PT ardaya'
       when sos.customer_name like 'fp flokq-apt pratama 1' then 'fp-2008 flokq-apt pratama 1'
       when sos.customer_name like 'FP Widi Mulia' then 'FP-1908 Widi Mulia'
       when sos.customer_name like 'fp bhinneka' then 'fp-2097 bhinneka'
       when sos.customer_name like 'fp bhinneka' then 'fp-2097 bhinneka'
       when sos.customer_name like 'FP-1668 Citra Indah T45' then 'FP-1688 Citra Indah T45'
       when sos.customer_name like 'FP-1668 Citra indah T35' then 'FP-1688 Citra indah T35'
       when sos.customer_name like 'PBF-1906 APT. Bellagio (Dennis)' then 'PBF-1852 APT. Bellagio (Dennis)'
       when sos.customer_name like 'fp BRI unpar' then 'fp-1912 BRI unpar'
       when sos.customer_name like 'FP PT Multi Bangun Persada' then 'FP-2233 PT Multi Bangun Persada'
       when sos.customer_name like 'fp pevita pearce' then 'fp-2226 pevita pearce'
       when sos.customer_name like 'fp-2196 ais siregar' then 'fp-2169 ais siregar'
       when sos.customer_name like 'mr donnie' then 'fp-2112 mr donnie'
       when sos.customer_name like 'fp-jd miranda' then 'fp-2391 jd miranda'
       when sos.customer_name like 'fp-jd sandy' then 'fp-2391 jd sandy'
       when sos.customer_name like 'FP Emral Setyawijayanto' then 'FP-2311 Emral Setyawijayanto'
       when sos.customer_name like 'fp-jd ana' then 'fp-2391 jd ana'
       when sos.customer_name like 'fp-jd jun' then 'fp-2391 jd jun'
       when sos.customer_name like 'FP Andre Alfonsius' then 'FP-2311 Andre Alfonsius'
       when sos.customer_name like 'FP Atika Wijayanthi' then 'FP-2311 Atika Wijayanthi'
       when sos.customer_name like 'FP Barli Sofwan' then 'FP-2311 Barli Sofwan'
       when sos.customer_name like 'FP Budi Prayitno' then 'FP-2311 Budi Prayitno'
       when sos.customer_name like 'FP Deni Nurwanti' then 'FP-2311 Deni Nurwanti'
       when sos.customer_name like 'FP Fachrul' then 'FP-2311 Fachrul'
       when sos.customer_name like 'FP Firnando Sianturi' then 'FP-2311 Firnando Sianturi'
       when sos.customer_name like 'FP Indra Harjanto' then 'FP-2311 Indra Harjanto'
       when sos.customer_name like 'FP Indra Putra Jaya' then 'FP-2311 Indra Putra Jaya'
       when sos.customer_name like 'FP Lilis Retno Werdiningsih' then 'FP-2311 Lilis Retno Werdiningsih'
       when sos.customer_name like 'FP Maryanie Dwi S.' then 'FP-2311 Maryanie Dwi S.'
       when sos.customer_name like 'FP Mia Kristiadewi' then 'FP-2311 Mia Kristiadewi'
       when sos.customer_name like 'FP Nunu Nugraha' then 'FP-2311 Nunu Nugraha'
       when sos.customer_name like 'FP Phiong Lumina' then 'FP-2311 Phiong Lumina'
       when sos.customer_name like 'FP Rainer Daniel Naibaho' then 'FP-2311 Rainer Daniel Naibaho'
       when sos.customer_name like 'FP Sri Nuarini' then 'FP-2311 Sri Nuarini'
       when sos.customer_name like 'FP Thamrin Salim' then 'FP-2311 Thamrin Salim'
       when sos.customer_name like 'FP Wirda Nelly' then 'FP-2311 Wirda Nelly'
       when sos.customer_name like 'FP Yesisca' then 'FP-2311 Yesisca'
       when sos.customer_name like 'fp Amelia Rizetti' then 'fp-2311 Amelia Rizetti'
       when sos.customer_name like 'fp Anastasia Rosarianti Suryo' then 'fp-2311 Anastasia Rosarianti Suryo'
       when sos.customer_name like 'fp Anny Renata Napitupulu' then 'fp-2311 Anny Renata Napitupulu' 
       when sos.customer_name like 'fp Astria Maharani M' then 'fp-2311 Astria Maharani M'
       when sos.customer_name like 'fp Budiy Susanto' then 'fp-2311 Budiy Susanto'
       when sos.customer_name like 'fp Caroline Fendiah T.' then 'fp-2311 Caroline Fendiah T.'
       when sos.customer_name like 'fp Charollina' then 'fp-2311 Charollina'
       when sos.customer_name like 'fp Devy A. Yheanne' then 'fp-2311 Devy A. Yheanne'
       when sos.customer_name like 'fp Dhiyan Kuncoro' then 'fp-2311 Dhiyan Kuncoro'
       when sos.customer_name like 'fp Erma Wijayanti' then 'fp-2311 Erma Wijayanti'
       when sos.customer_name like 'fp Felisia Sunaryo' then 'fp-2311 Felisia Sunaryo'
       when sos.customer_name like 'fp Hanif Paramartha' then 'fp-2311 Hanif Paramartha'
       when sos.customer_name like 'fp Livia Serafin' then 'fp-2311 Livia Serafin' 
       when sos.customer_name like 'fp Marisca Ariani' then 'fp-2311 Marisca Ariani'
       when sos.customer_name like 'fp Muhamad Rama Sundjaya' then 'fp-2311 Muhamad Rama Sundjaya'
       when sos.customer_name like 'fp Nadia Ratih' then 'fp-2311 Nadia Ratih' 
       when sos.customer_name like 'fp Nian Safitri' then 'fp-2311 Nian Safitri'
       when sos.customer_name like 'fp Novie' then 'fp-2311 Novie'
       when sos.customer_name like 'fp Novie Kristanti' then 'fp-2311 Novie Kristanti'
       when sos.customer_name like 'fp Rays Mitchelle' then 'fp-2311 Rays Mitchelle'
       when sos.customer_name like 'fp Riris Paula Pardosi' then 'fp-2311 Riris Paula Pardosi'
       when sos.customer_name like 'fp Ronak Trivedi' then 'fp-2311 Ronak Trivedi'
       when sos.customer_name like 'fp Sasmita Nurdin' then 'fp-2311 Sasmita Nurdin' 
       when sos.customer_name like 'fp Siti Latifah' then 'fp-2311 Siti Latifah'
       when sos.customer_name like 'fp Sri Hastuti Kumaladewi' then 'fp-2311 Sri Hastuti Kumaladewi'
       when sos.customer_name like 'fp Tuang Lee' then 'fp-2311 Tuang Lee'
       when sos.customer_name like 'fp Vera Indah Sari' then 'fp-2311 Vera Indah Sari' 
       when sos.customer_name like 'fp Vincentia Dwi Setyaningtyas' then 'fp-2311 Vincentia Dwi Setyaningtyas'
       when sos.customer_name like 'fp Wibowo Kristianto' then 'fp-2311 Wibowo Kristianto'
       when sos.customer_name like 'fp Winarti Pangestu' then 'fp-2311 Winarti Pangestu' 
       when sos.customer_name like 'FP Achyani Yusni' then 'FP-2311 Achyani Yusni'
       when sos.customer_name like 'FP Adilla Novita Sari' then 'FP-2311 Adilla Novita Sari'
       when sos.customer_name like 'FP Agapitus Fajar Raharjo' then 'FP-2311 Agapitus Fajar Raharjo'
       when sos.customer_name like 'FP Annisyah' then 'FP-2311 Annisyah'
       when sos.customer_name like 'FP Arthur Mamahit' then 'FP-2311 Arthur Mamahit'
       when sos.customer_name like 'FP Astari Fitriani' then 'FP-2311 Astari Fitriani'
       when sos.customer_name like 'FP Baih Tunggal Saputra' then 'FP-2311 Baih Tunggal Saputra'
       when sos.customer_name like 'FP Benny Michael Hariandja' then 'FP-2311 Benny Michael Hariandja' 
       when sos.customer_name like 'FP Brian Wijaya' then 'FP-2311 Brian Wijaya' 
       when sos.customer_name like 'FP Desy Kristanti' then 'FP-2311 Desy Kristanti'
       when sos.customer_name like 'FP Diana Widyawati' then 'FP-2311 Diana Widyawati'
       when sos.customer_name like 'FP Erwin Triguno' then 'FP-2311 Erwin Triguno'
       when sos.customer_name like 'FP Joshua Wijaya' then 'FP-2311 Joshua Wijaya'
       when sos.customer_name like 'FP Kartika Chaerani' then 'FP-2311 Kartika Chaerani'
       when sos.customer_name like 'FP Mia Fitriany' then 'FP-2311 Mia Fitriany'
       when sos.customer_name like 'FP Mita Yunita' then 'FP-2311 Mita Yunita'
       when sos.customer_name like 'FP Raja Nada Octava' then 'FP-2311 Raja Nada Octava'
       when sos.customer_name like 'FP Tania Budiman' then 'FP-2311 Tania Budiman'
       when sos.customer_name like 'FP Tenny Anggia M. Pramono' then 'FP-2311 Tenny Anggia M. Pramono'
       when sos.customer_name like 'FP Yessica' then 'FP-2311 Yessica'
       when sos.customer_name like 'fp Allan Bara Yufi' then 'fp-2311 Allan Bara Yufi'
       when sos.customer_name like 'fp Anindita Ayu Pranawestri' then 'fp-2311 Anindita Ayu Pranawestri'
       when sos.customer_name like 'fp Anisa Wulandari' then 'fp-2311 Anisa Wulandari'
       when sos.customer_name like 'fp Asrina' then 'fp-2311 Asrina'
       when sos.customer_name like 'fp Chandra Jumawa' then 'fp-2311 Chandra Jumawa'
       when sos.customer_name like 'fp Dinda Parameswari' then 'fp-2311 Dinda Parameswari'
       when sos.customer_name like 'fp Erwin Hariman Rahman' then 'fp-2311 Erwin Hariman Rahman'
       when sos.customer_name like 'fp Faisal Aminulloh' then 'fp-2311 Faisal Aminulloh'
       when sos.customer_name like 'fp Fika Yolanda' then 'fp-2311 Fika Yolanda'
       when sos.customer_name like 'fp Freddy Hendrarto' then 'fp-2311 Freddy Hendrarto'
       when sos.customer_name like 'fp Hanna Siregar' then 'fp-2311 Hanna Siregar'
       when sos.customer_name like 'fp Intan Nur Inayah' then 'fp-2311 Intan Nur Inayah'
       when sos.customer_name like 'fp Lusyane Eko Tantri' then 'fp-2311 Lusyane Eko Tantri' 
       when sos.customer_name like 'fp Maya Prischilla' then 'fp-2311 Maya Prischilla'
       when sos.customer_name like 'fp Muhammad Rizal' then 'fp-2311 Muhammad Rizal'
       when sos.customer_name like 'fp Nidya G Sitanala' then 'fp-2311 Nidya G Sitanala'
       when sos.customer_name like 'fp Pena Lukis Pertiwi' then 'fp-2311 Pena Lukis Pertiwi'
       when sos.customer_name like 'fp Rian Surachman' then 'fp-2311 Rian Surachman' 
       when sos.customer_name like 'fp Rikka Anggitha' then 'fp-2311 Rikka Anggitha'
       when sos.customer_name like 'fp Teguh Adi Prabowo' then 'fp-2311 Teguh Adi Prabowo'
       when sos.customer_name like 'fp Ventry Effendy' then 'fp-2311 Ventry Effendy'
       when sos.customer_name like 'fp Vin Cent' then 'fp-2311 Vin Cent'
       when sos.customer_name like 'fp Yuni Sunaryo' then 'fp-2311 Yuni Sunaryo'
       when sos.customer_name like 'FP Abdurrahman Wijisaksono' then 'FP-2311 Abdurrahman Wijisaksono' 
       when sos.customer_name like 'FP Edwin Denecke' then 'FP-2311 Edwin Denecke'
       when sos.customer_name like 'FP Elok Faiqoh' then 'FP-2311 Elok Faiqoh'
       when sos.customer_name like 'FP Endah Putri' then 'FP-2311 Endah Putri'
       when sos.customer_name like 'FP Hartono Wibowo' then 'FP-2311 Hartono Wibowo' 
       when sos.customer_name like 'FP Heri Rukmana' then 'FP-2311 Heri Rukmana' 
       when sos.customer_name like 'FP Jimmy Anggriani' then 'FP-2311 Jimmy Anggriani' 
       when sos.customer_name like 'FP Mira Indriani' then 'FP-2311 Mira Indriani'
       when sos.customer_name like 'FP Muhammad Rizki' then 'FP-2311 Muhammad Rizki' 
       when sos.customer_name like 'FP Natalia Liu' then 'FP-2311 Natalia Liu'
       when sos.customer_name like 'FP Sri Ampuni Mibawani' then 'FP-2311 Sri Ampuni Mibawani' 
       when sos.customer_name like 'FP Suwibowo' then 'FP-2311 Suwibowo' 
       when sos.customer_name like 'FP Tiara Dasmahesty' then 'FP-2311 Tiara Dasmahesty'
       when sos.customer_name like 'fp Ardhata Pratama' then 'fp-2311 Ardhata Pratama'
       when sos.customer_name like 'fp Aswin Agastya' then 'fp-2311 Aswin Agastya'
       when sos.customer_name like 'fp Bhudi Darmawan' then 'fp-2311 Bhudi Darmawan'
       when sos.customer_name like 'fp Desi Puspita' then 'fp-2311 Desi Puspita' 
       when sos.customer_name like 'fp Eko Edy Suntoro' then 'fp-2311 Eko Edy Suntoro'
       when sos.customer_name like 'fp Indah Rizfa Hannanah' then 'fp-2311 Indah Rizfa Hannanah' 
       when sos.customer_name like 'fp Jagarda Saragih' then 'fp-2311 Jagarda Saragih' 
       when sos.customer_name like 'fp Janet Novelia' then 'fp-2311 Janet Novelia' 
       when sos.customer_name like 'fp Jesslyn N. Kosasih' then 'fp-2311 Jesslyn N. Kosasih' 
       when sos.customer_name like 'fp Lara Pranata Gianieri' then 'fp-2311 Lara Pranata Gianieri'
       when sos.customer_name like 'fp Latifah hamid' then 'fp-2311 Latifah hamid'
       when sos.customer_name like 'fp Lucia Budidharma' then 'fp-2311 Lucia Budidharma' 
       when sos.customer_name like 'fp Muhammad Ilmansyah' then 'fp-2311 Muhammad Ilmansyah'
       when sos.customer_name like 'fp Nur Fitriana' then 'fp-2311 Nur Fitriana'
       when sos.customer_name like 'fp Reri Rosana Wita' then 'fp-2311 Reri Rosana Wita'
       when sos.customer_name like 'fp Sandy Firmansyah' then 'fp-2311 Sandy Firmansyah'
       when sos.customer_name like 'fp Satriati Tanjung' then 'fp-2311 Satriati Tanjung'
       when sos.customer_name like 'fp Sulistiyaningsih' then 'fp-2311 Sulistiyaningsih' 
       when sos.customer_name like 'fp Susiwaty Chandra' then 'fp-2311 Susiwaty Chandra'
       when sos.customer_name like 'fp Tia Kartikapura' then 'fp-2311 Tia Kartikapura' 
       when sos.customer_name like 'fp Yudith Arianda' then 'fp-2311 Yudith Arianda' 
       when sos.customer_name like 'FP Agus Salim' then 'FP-2311 Agus Salim' 
       when sos.customer_name like 'FP Asmarina Setianingsih' then 'FP-2311 Asmarina Setianingsih'
       when sos.customer_name like 'FP Bayu Aji' then 'FP-2311 Bayu Aji' 
       when sos.customer_name like 'FP Rezza Maulana Fahlevie' then 'FP-2311 Rezza Maulana Fahlevie'
       when sos.customer_name like 'FP Tengku Vannesa Rilviena' then 'FP-2311 Tengku Vannesa Rilviena' 
       when sos.customer_name like 'FP Willy Monika Yohansyah' then 'FP-2311 Willy Monika Yohansyah' 
       when sos.customer_name like 'fp Alberts Hendrajaya' then 'fp-2311 Alberts Hendrajaya'
       when sos.customer_name like 'fp Albertus Andre' then 'fp-2311 Albertus Andre' 
       when sos.customer_name like 'fp Alfonso Riza' then 'fp-2311 Alfonso Riza'
       when sos.customer_name like 'fp Annisa Hamzar' then 'fp-2311 Annisa Hamzar' 
       when sos.customer_name like 'fp Christine Balingit-Ledesma' then 'fp-2311 Christine Balingit-Ledesma'
       when sos.customer_name like 'fp Dian Rahmasari' then 'fp-2311 Dian Rahmasari' 
       when sos.customer_name like 'fp Dimyati Yusuf' then 'fp-2311 Dimyati Yusuf' 
       when sos.customer_name like 'fp Kun Fitriana Mahmudah' then 'fp-2311 Kun Fitriana Mahmudah' 
       when sos.customer_name like 'fp Maria Verita Vita Christiani' then 'fp-2311 Maria Verita Vita Christiani' 
       when sos.customer_name like 'fp Natalia Mulia' then 'fp-2311 Natalia Mulia' 
       when sos.customer_name like 'fp Stacy Samuel' then 'fp-2311 Stacy Samuel'
       when sos.customer_name like 'fp Wynne Lukman' then 'fp-2311 Wynne Lukman'
       when sos.customer_name like 'fp Zaki Makarim' then 'fp-2311 Zaki Makarim'
       when sos.customer_name like 'fp Anggoro Yuniarso' then 'fp-2311 Anggoro Yuniarso' 
       when sos.customer_name like 'fp Arief Budi Santoso' then 'fp-2311 Arief Budi Santoso'
       when sos.customer_name like 'fp Bayu Iman Eryawan' then 'fp-2311 Bayu Iman Eryawan'
       when sos.customer_name like 'fp Bayu Wicaksono' then 'fp-2311 Bayu Wicaksono' 
       when sos.customer_name like 'fp Chairunnisa' then 'fp-2311 Chairunnisa'
       when sos.customer_name like 'fp Cristine Dwi Octaviani' then 'fp-2311 Cristine Dwi Octaviani' 
       when sos.customer_name like 'fp Dedi Darmasah' then 'fp-2311 Dedi Darmasah' 
       when sos.customer_name like 'fp Dewan Ridwan Abdurrazaq' then 'fp-2311 Dewan Ridwan Abdurrazaq'
       when sos.customer_name like 'fp Euis Komalasari' then 'fp-2311 Euis Komalasari'
       when sos.customer_name like 'fp Fika Lestari' then 'fp-2311 Fika Lestari' 
       when sos.customer_name like 'fp Ikhwan Brata Kusuma' then 'fp-2311 Ikhwan Brata Kusuma'
       when sos.customer_name like 'fp Kamino' then 'fp-2311 Kamino'
       when sos.customer_name like 'fp Moh. Andriansyah' then 'fp-2311 Moh. Andriansyah' 
       when sos.customer_name like 'fp Monique Tenggerdjati' then 'fp-2311 Monique Tenggerdjati'
       when sos.customer_name like 'fp RIANSAR B NUGROHO' then 'fp-2311 RIANSAR B NUGROHO'
       when sos.customer_name like 'fp Rangga Fadillah' then 'fp-2311 Rangga Fadillah' 
       when sos.customer_name like 'fp Ribka Suhardi' then 'fp-2311 Ribka Suhardi'
       when sos.customer_name like 'fp Romi Hardian' then 'fp-2311 Romi Hardian'
       when sos.customer_name like 'fp Sri Handayani Kusumastuti' then 'fp-2311 Sri Handayani Kusumastuti'
       when sos.customer_name like 'fp Sri Harini' then 'fp-2311 Sri Harini' 
       when sos.customer_name like 'fp Sudaryani' then 'fp-2311 Sudaryani'
       when sos.customer_name like 'fp Syafriliza Herianda' then 'fp-2311 Syafriliza Herianda' 
       when sos.customer_name like 'fp TUTUR ARIYANTO' then 'fp-2311 TUTUR ARIYANTO' 
       when sos.customer_name like 'fp Wisnu Wardana' then 'fp-2311 Wisnu Wardana'
       when sos.customer_name like 'fp amelia' then 'fp-2311 amelia'
       when sos.customer_name like 'fp aukaria rahman' then 'fp-2311 aukaria rahman'
       when sos.customer_name like 'fp Ade Kresna Kemaltaba' then 'fp-2311 Ade Kresna Kemaltaba' 
       when sos.customer_name like 'fp Anisa Nur Bintari' then 'fp-2311 Anisa Nur Bintari'
       when sos.customer_name like 'fp Ansgar Paska Da Lopez' then 'fp-2311 Ansgar Paska Da Lopez' 
       when sos.customer_name like 'fp Apyt Sulystyanto' then 'fp-2311 Apyt Sulystyanto' 
       when sos.customer_name like 'fp Arleen Tarnadjaja Putri' then 'fp-2311 Arleen Tarnadjaja Putri' 
       when sos.customer_name like 'fp Citra Tridewi Azalea' then 'fp-2311 Citra Tridewi Azalea' 
       when sos.customer_name like 'fp Daniel Sebayang' then 'fp-2311 Daniel Sebayang' 
       when sos.customer_name like 'fp Danik Sudarwati' then 'fp-2311 Danik Sudarwati' 
       when sos.customer_name like 'fp Dian Wulandari Nuhraheni' then 'fp-2311 Dian Wulandari Nuhraheni'
       when sos.customer_name like 'fp Femmy Dealiser sitorus,' then 'fp-2311 Femmy Dealiser sitorus,'
       when sos.customer_name like 'fp Guna Hari Shandy' then 'fp-2311 Guna Hari Shandy'
       when sos.customer_name like 'fp Lisa Naftali' then 'fp-2311 Lisa Naftali'
       when sos.customer_name like 'fp Moch Riyadh' then 'fp-2311 Moch Riyadh' 
       when sos.customer_name like 'fp Nesya Aklima Thaibsyah' then 'fp-2311 Nesya Aklima Thaibsyah'
       when sos.customer_name like 'fp Nuraini Naufal' then 'fp-2311 Nuraini Naufal'
       when sos.customer_name like 'fp Riza Helmy' then 'fp-2311 Riza Helmy' 
       when sos.customer_name like 'fp Rospita Dian' then 'fp-2311 Rospita Dian' 
       when sos.customer_name like 'fp Silvy Rivan' then 'fp-2311 Silvy Rivan' 
       when sos.customer_name like 'fp Supomo' then 'fp-2311 Supomo'
       when sos.customer_name like 'fp Vio Araneta' then 'fp-2311 Vio Araneta' 
       when sos.customer_name like 'fp-jd fangqi hermawan' then 'fp-2391 jd fangqi hermawan'
       when sos.customer_name like 'fp Alfin Darwongso' then 'fp-2311 Alfin Darwongso'
       when sos.customer_name like 'fp Anggraeni Setyadewi' then 'fp-2311 Anggraeni Setyadewi'
       when sos.customer_name like 'fp Feggie Mediano' then 'fp-2311 Feggie Mediano' 
       when sos.customer_name like 'fp Maria Fatma Nuraini' then 'fp-2311 Maria Fatma Nuraini'
       when sos.customer_name like 'fp Marieska M Sebastian' then 'fp-2311 Marieska M Sebastian' 
       when sos.customer_name like 'fp Mohammad Hamami' then 'fp-2311 Mohammad Hamami' 
       when sos.customer_name like 'fp Mutia Sayekti' then 'fp-2311 Mutia Sayekti' 
       when sos.customer_name like 'fp Olivia Wahyuningrum' then 'fp-2311 Olivia Wahyuningrum'
       when sos.customer_name like 'fp Prima Wikaningtyas' then 'fp-2311 Prima Wikaningtyas' 
       when sos.customer_name like 'fp Sadiqin Yasin' then 'fp-2311 Sadiqin Yasin'
       when sos.customer_name like 'fp Syeni Noviardy' then 'fp-2311 Syeni Noviardy'
       when sos.customer_name like 'fp Uray camila Insani' then 'fp-2311 Uray camila Insani'
       when sos.customer_name like 'fp Yulia Sari' then 'fp-2311 Yulia Sari' 
       when sos.customer_name like 'fp-jd ami' then 'fp-2391 jd ami' 
       when sos.customer_name like 'fp Afrida Krishartanto' then 'fp-2311 Afrida Krishartanto' 
       when sos.customer_name like 'fp Andy Ekayudha' then 'fp-2311 Andy Ekayudha'
       when sos.customer_name like 'fp Cucup Koswara' then 'fp-2311 Cucup Koswara' 
       when sos.customer_name like 'fp Elfrida Heriawan' then 'fp-2311 Elfrida Heriawan' 
       when sos.customer_name like 'fp Jovita Arianti' then 'fp-2311 Jovita Arianti' 
       when sos.customer_name like 'fp M Hasyrul Soleh' then 'fp-2311 M Hasyrul Soleh'
       when sos.customer_name like 'fp-jd nuvai' then 'fp-2391 jd nuvai'
       when sos.customer_name like 'fp-jd kharisma yusuf barus' then 'fp-2391 jd kharisma yusuf barus'
       when sos.customer_name like 'fp-jd Claudia Centurini' then 'fp-2391 jd Claudia Centurini'
       when sos.customer_name like 'fp-jd nanang fahrudi' then 'fp-2391 jd nanang fahrudi' 
       when sos.customer_name like 'fp-jd yosep supriatna' then 'fp-2391 jd yosep supriatna'
       when sos.customer_name like 'fp-jd yovica sagina' then 'fp-2391 jd yovica sagina'
       when sos.customer_name like 'fp-2232 PT lifepal technologies' then 'fp-2322 PT lifepal technologies'
       when sos.customer_name like 'fp-2247 pusat gadai emas' then 'fp-2287 pusat gadai emas'
       when sos.customer_name like 'fp gema graha sarana' then 'fp-2379 gema graha sarana'
       when sos.customer_name like 'fp Andri Aulia' then 'fp-2311 Andri Aulia'
       when sos.customer_name like 'FP Susy Tri Lomorti Simanullang' then 'FP-2311 Susy Tri Lomorti Simanullang'
       when sos.customer_name like 'FP Revina Rizky Angelia' then 'FP-2311 Revina Rizky Angelia'
       when sos.customer_name like 'FP Flokq' then 'FP-2077 Flokq'
       when sos.customer_name like 'fp-2216 Rizka' then 'fp-2203 Rizka'
       when sos.customer_name like 'fp-2777 feryanthi putria' then 'fp-2277 feryanthi putri'
       when sos.customer_name like 'FP Gema Graha Sarana' then 'FP-2367 Gema Graha Sarana'
       when sos.customer_name like 'Alief Akbar' then 'fp-2438 Alief Akbar'
       when sos.customer_name like 'fp-2270 syifa' then 'fp-2279 syifa'
       when sos.customer_name like 'fp-2343 febriana' then 'fp-2342 febriana'
       when sos.customer_name like 'fp-2286 andry' then 'fp-2258 andry'
       when sos.customer_name like 'fp-2931 neri' then 'fp-2391 neri'
       when sos.customer_name like 'fp Yohanna' then 'fp-2311 Yohanna'
       when sos.customer_name like 'FP Dewi Sinaga' then 'FP-2311 Dewi Sinaga'
       when sos.customer_name like 'fp-2777 feryanthi putri' then 'fp-2277 feryanthi putri'
       when sos.customer_name like 'JD.ID JD.ID' then 'fp-2391 JD.ID JD.ID'
              else sos.customer_name  end as cust_name
-- , case when sod.product_type ='Custom' and sod.sku like '%furniture%' then 'Custom Furniture'
--        when sod.product_type ='Custom' and sod.sku not like '%furniture%' then 'Civil Work'
--        when sod.product_type in ('Retail', 'Marketplace', 'MP Consignment')  and sod.sku not like '%furniture%' then 'Loose Furniture'
--            else sod.product_type end as service
, sos.customer_city
, sos.customer_subdistrict
, sos.customer_village
FROM `fabelio-bi.dwh.fact_sales_order_detail` sod
left join `fabelio-bi.dwh.fact_sales_order_summary` sos on sos.increment_id=sod.increment_id
where sod.order_status = 'Valid' and sod.order_type='PBF'
and sod.trans_date >= '2021-01-01'
and sod.nmv > 0
)

, switch1 as
(select replace(cust_name, 'PBF-' , 'pbf-') cust_name1 ,* from trans)

, switch2 as
(select replace(cust_name1, 'fp-' , 'pbf-') cust_name2 ,* from switch1)

, switch3 as
(select replace(cust_name2, 'FP-' , 'pbf-') cust_name3 ,* from switch2)

, switch4 as
(select replace(cust_name3, 'hbf-' , 'pbf-') cust_name4 ,* from switch3)

, getpbf as 
(select * , regexp_extract(cust_name4, r'\bpbf-[0-9]*') cust_name5 from switch4)


, key as 
(select replace(cust_name5, 'pbf-', '') cust_key , * from getpbf)

, project as
(
select case   when cust_name like '%1675%' then 'hbf-1675'
              when cust_name like 'Pbf 1603 widian' then 'pbf-1603 widian'
              when cust_name like 'pbf retno' then 'pbf-1800'
              when cust_name like 'pbf PT.PGAS Solution' then 'pbf-1898'
              when cust_name like 'hbf-1415 rayhan' then 'pbf-1415 rayhan'
              when cust_name like 'PBF 1909 PT. Parama Putra Mas Mandiri' then 'pbf-1909 PT. Parama Putra Mas Mandiri'
              when cust_name like 'HBF-708 FRANS (EKSEKUTIF ROOM)' then 'pbf-708 FRANS (EKSEKUTIF ROOM)'
              when cust_name like 'PBF=1857 Janji Jiwa' then 'pbf-1857 Janji Jiwa'
              when cust_name like 'PNF-1675-565 REINALDI EKA Oshop' then 'pbf-1675-565 REINALDI EKA Oshop'
              when cust_name like 'pf-1824 skandinavian apartment (1 bedroom)' then 'pbf-1824 skandinavian apartment (1 bedroom)'
              when cust_name like 'db-218 roommie' then 'pbf-218 roommie'
              when cust_name like 'FP Samsung' then 'FP-2071 Samsung'
              when cust_name like 'fp samsung' then 'FP-2071 Samsung'
              when cust_name like 'fp po pasar jaya' then 'fp-1792 po pasar'
              when cust_name like 'fp PT ardaya' then 'fp-2072 PT ardaya'
              when cust_name like 'fp flokq-apt pratama 1' then 'fp-2008 flokq-apt pratama 1'
              when cust_name like 'FP Widi Mulia' then 'FP-1908 Widi Mulia'
              when cust_name like 'fp bhinneka' then 'fp-2097 bhinneka'
              when cust_name like 'FP-1668 Citra Indah T45' then 'FP-1688 Citra Indah T45'
              when cust_name like 'FP-1668 Citra indah T35' then 'FP-1688 Citra indah T35'
              when cust_name like 'PBF-1906 APT. Bellagio (Dennis)' then 'PBF-1852 APT. Bellagio (Dennis)'
              when cust_name like 'fp BRI unpar' then 'fp-1912 BRI unpar'
              when cust_name like 'FP PT Multi Bangun Persada' then 'FP-2233 PT Multi Bangun Persada'
              when cust_name like 'fp pevita pearce' then 'fp-2226 pevita pearce'
              when cust_name like 'fp-2196 ais siregar' then 'fp-2169 ais siregar'
              when cust_name like 'mr donnie' then 'fp-2112 mr donnie'
              when cust_name like 'fp-jd miranda' then 'fp-2391 jd miranda'
              when cust_name like 'fp-jd sandy' then 'fp-2391 jd sandy'
              when cust_name like 'FP Emral Setyawijayanto' then 'FP-2311 Emral Setyawijayanto'
              when cust_name like 'fp-jd ana' then 'fp-2391 jd ana'
              when cust_name like 'fp-jd jun' then 'fp-2391 jd jun'
              when cust_name like 'FP Andre Alfonsius' then 'FP-2311 Andre Alfonsius'
              when cust_name like 'FP Atika Wijayanthi' then 'FP-2311 Atika Wijayanthi'
              when cust_name like 'FP Barli Sofwan' then 'FP-2311 Barli Sofwan'
              when cust_name like 'FP Budi Prayitno' then 'FP-2311 Budi Prayitno'
              when cust_name like 'FP Deni Nurwanti' then 'FP-2311 Deni Nurwanti'
              when cust_name like 'FP Fachrul' then 'FP-2311 Fachrul'
              when cust_name like 'FP Firnando Sianturi' then 'FP-2311 Firnando Sianturi'
              when cust_name like 'FP Indra Harjanto' then 'FP-2311 Indra Harjanto'
              when cust_name like 'FP Indra Putra Jaya' then 'FP-2311 Indra Putra Jaya'
              when cust_name like 'FP Lilis Retno Werdiningsih' then 'FP-2311 Lilis Retno Werdiningsih'
              when cust_name like 'FP Maryanie Dwi S.' then 'FP-2311 Maryanie Dwi S.'
              when cust_name like 'FP Mia Kristiadewi' then 'FP-2311 Mia Kristiadewi'
              when cust_name like 'FP Nunu Nugraha' then 'FP-2311 Nunu Nugraha'
              when cust_name like 'FP Phiong Lumina' then 'FP-2311 Phiong Lumina'
              when cust_name like 'FP Rainer Daniel Naibaho' then 'FP-2311 Rainer Daniel Naibaho'
              when cust_name like 'FP Sri Nuarini' then 'FP-2311 Sri Nuarini'
              when cust_name like 'FP Thamrin Salim' then 'FP-2311 Thamrin Salim'
              when cust_name like 'FP Wirda Nelly' then 'FP-2311 Wirda Nelly'
              when cust_name like 'FP Yesisca' then 'FP-2311 Yesisca'
              when cust_name like 'fp Amelia Rizetti' then 'fp-2311 Amelia Rizetti'
              when cust_name like 'fp Anastasia Rosarianti Suryo' then 'fp-2311 Anastasia Rosarianti Suryo'
              when cust_name like 'fp Anny Renata Napitupulu' then 'fp-2311 Anny Renata Napitupulu' 
              when cust_name like 'fp Astria Maharani M' then 'fp-2311 Astria Maharani M'
              when cust_name like 'fp Budiy Susanto' then 'fp-2311 Budiy Susanto'
              when cust_name like 'fp Caroline Fendiah T.' then 'fp-2311 Caroline Fendiah T.'
              when cust_name like 'fp Charollina' then 'fp-2311 Charollina'
              when cust_name like 'fp Devy A. Yheanne' then 'fp-2311 Devy A. Yheanne'
              when cust_name like 'fp Dhiyan Kuncoro' then 'fp-2311 Dhiyan Kuncoro'
              when cust_name like 'fp Erma Wijayanti' then 'fp-2311 Erma Wijayanti'
              when cust_name like 'fp Felisia Sunaryo' then 'fp-2311 Felisia Sunaryo'
              when cust_name like 'fp Hanif Paramartha' then 'fp-2311 Hanif Paramartha'
              when cust_name like 'fp Livia Serafin' then 'fp-2311 Livia Serafin' 
              when cust_name like 'fp Marisca Ariani' then 'fp-2311 Marisca Ariani'
              when cust_name like 'fp Muhamad Rama Sundjaya' then 'fp-2311 Muhamad Rama Sundjaya'
              when cust_name like 'fp Nadia Ratih' then 'fp-2311 Nadia Ratih' 
              when cust_name like 'fp Nian Safitri' then 'fp-2311 Nian Safitri'
              when cust_name like 'fp Novie' then 'fp-2311 Novie'
              when cust_name like 'fp Novie Kristanti' then 'fp-2311 Novie Kristanti'
              when cust_name like 'fp Rays Mitchelle' then 'fp-2311 Rays Mitchelle'
              when cust_name like 'fp Riris Paula Pardosi' then 'fp-2311 Riris Paula Pardosi'
              when cust_name like 'fp Ronak Trivedi' then 'fp-2311 Ronak Trivedi'
              when cust_name like 'fp Sasmita Nurdin' then 'fp-2311 Sasmita Nurdin' 
              when cust_name like 'fp Siti Latifah' then 'fp-2311 Siti Latifah'
              when cust_name like 'fp Sri Hastuti Kumaladewi' then 'fp-2311 Sri Hastuti Kumaladewi'
              when cust_name like 'fp Tuang Lee' then 'fp-2311 Tuang Lee'
              when cust_name like 'fp Vera Indah Sari' then 'fp-2311 Vera Indah Sari' 
              when cust_name like 'fp Vincentia Dwi Setyaningtyas' then 'fp-2311 Vincentia Dwi Setyaningtyas'
              when cust_name like 'fp Wibowo Kristianto' then 'fp-2311 Wibowo Kristianto'
              when cust_name like 'fp Winarti Pangestu' then 'fp-2311 Winarti Pangestu' 
              when cust_name like 'FP Achyani Yusni' then 'FP-2311 Achyani Yusni'
              when cust_name like 'FP Adilla Novita Sari' then 'FP-2311 Adilla Novita Sari'
              when cust_name like 'FP Agapitus Fajar Raharjo' then 'FP-2311 Agapitus Fajar Raharjo'
              when cust_name like 'FP Annisyah' then 'FP-2311 Annisyah'
              when cust_name like 'FP Arthur Mamahit' then 'FP-2311 Arthur Mamahit'
              when cust_name like 'FP Astari Fitriani' then 'FP-2311 Astari Fitriani'
              when cust_name like 'FP Baih Tunggal Saputra' then 'FP-2311 Baih Tunggal Saputra'
              when cust_name like 'FP Benny Michael Hariandja' then 'FP-2311 Benny Michael Hariandja' 
              when cust_name like 'FP Brian Wijaya' then 'FP-2311 Brian Wijaya' 
              when cust_name like 'FP Desy Kristanti' then 'FP-2311 Desy Kristanti'
              when cust_name like 'FP Diana Widyawati' then 'FP-2311 Diana Widyawati'
              when cust_name like 'FP Erwin Triguno' then 'FP-2311 Erwin Triguno'
              when cust_name like 'FP Joshua Wijaya' then 'FP-2311 Joshua Wijaya'
              when cust_name like 'FP Kartika Chaerani' then 'FP-2311 Kartika Chaerani'
              when cust_name like 'FP Mia Fitriany' then 'FP-2311 Mia Fitriany'
              when cust_name like 'FP Mita Yunita' then 'FP-2311 Mita Yunita'
              when cust_name like 'FP Raja Nada Octava' then 'FP-2311 Raja Nada Octava'
              when cust_name like 'FP Tania Budiman' then 'FP-2311 Tania Budiman'
              when cust_name like 'FP Tenny Anggia M. Pramono' then 'FP-2311 Tenny Anggia M. Pramono'
              when cust_name like 'FP Yessica' then 'FP-2311 Yessica'
              when cust_name like 'fp Allan Bara Yufi' then 'fp-2311 Allan Bara Yufi'
              when cust_name like 'fp Anindita Ayu Pranawestri' then 'fp-2311 Anindita Ayu Pranawestri'
              when cust_name like 'fp Anisa Wulandari' then 'fp-2311 Anisa Wulandari'
              when cust_name like 'fp Asrina' then 'fp-2311 Asrina'
              when cust_name like 'fp Chandra Jumawa' then 'fp-2311 Chandra Jumawa'
              when cust_name like 'fp Dinda Parameswari' then 'fp-2311 Dinda Parameswari'
              when cust_name like 'fp Erwin Hariman Rahman' then 'fp-2311 Erwin Hariman Rahman'
              when cust_name like 'fp Faisal Aminulloh' then 'fp-2311 Faisal Aminulloh'
              when cust_name like 'fp Fika Yolanda' then 'fp-2311 Fika Yolanda'
              when cust_name like 'fp Freddy Hendrarto' then 'fp-2311 Freddy Hendrarto'
              when cust_name like 'fp Hanna Siregar' then 'fp-2311 Hanna Siregar'
              when cust_name like 'fp Intan Nur Inayah' then 'fp-2311 Intan Nur Inayah'
              when cust_name like 'fp Lusyane Eko Tantri' then 'fp-2311 Lusyane Eko Tantri' 
              when cust_name like 'fp Maya Prischilla' then 'fp-2311 Maya Prischilla'
              when cust_name like 'fp Muhammad Rizal' then 'fp-2311 Muhammad Rizal'
              when cust_name like 'fp Nidya G Sitanala' then 'fp-2311 Nidya G Sitanala'
              when cust_name like 'fp Pena Lukis Pertiwi' then 'fp-2311 Pena Lukis Pertiwi'
              when cust_name like 'fp Rian Surachman' then 'fp-2311 Rian Surachman' 
              when cust_name like 'fp Rikka Anggitha' then 'fp-2311 Rikka Anggitha'
              when cust_name like 'fp Teguh Adi Prabowo' then 'fp-2311 Teguh Adi Prabowo'
              when cust_name like 'fp Ventry Effendy' then 'fp-2311 Ventry Effendy'
              when cust_name like 'fp Vin Cent' then 'fp-2311 Vin Cent'
              when cust_name like 'fp Yuni Sunaryo' then 'fp-2311 Yuni Sunaryo'
              when cust_name like 'FP Abdurrahman Wijisaksono' then 'FP-2311 Abdurrahman Wijisaksono' 
              when cust_name like 'FP Edwin Denecke' then 'FP-2311 Edwin Denecke'
              when cust_name like 'FP Elok Faiqoh' then 'FP-2311 Elok Faiqoh'
              when cust_name like 'FP Endah Putri' then 'FP-2311 Endah Putri'
              when cust_name like 'FP Hartono Wibowo' then 'FP-2311 Hartono Wibowo' 
              when cust_name like 'FP Heri Rukmana' then 'FP-2311 Heri Rukmana' 
              when cust_name like 'FP Jimmy Anggriani' then 'FP-2311 Jimmy Anggriani' 
              when cust_name like 'FP Mira Indriani' then 'FP-2311 Mira Indriani'
              when cust_name like 'FP Muhammad Rizki' then 'FP-2311 Muhammad Rizki' 
              when cust_name like 'FP Natalia Liu' then 'FP-2311 Natalia Liu'
              when cust_name like 'FP Sri Ampuni Mibawani' then 'FP-2311 Sri Ampuni Mibawani' 
              when cust_name like 'FP Suwibowo' then 'FP-2311 Suwibowo' 
              when cust_name like 'FP Tiara Dasmahesty' then 'FP-2311 Tiara Dasmahesty'
              when cust_name like 'fp Ardhata Pratama' then 'fp-2311 Ardhata Pratama'
              when cust_name like 'fp Aswin Agastya' then 'fp-2311 Aswin Agastya'
              when cust_name like 'fp Bhudi Darmawan' then 'fp-2311 Bhudi Darmawan'
              when cust_name like 'fp Desi Puspita' then 'fp-2311 Desi Puspita' 
              when cust_name like 'fp Eko Edy Suntoro' then 'fp-2311 Eko Edy Suntoro'
              when cust_name like 'fp Indah Rizfa Hannanah' then 'fp-2311 Indah Rizfa Hannanah' 
              when cust_name like 'fp Jagarda Saragih' then 'fp-2311 Jagarda Saragih' 
              when cust_name like 'fp Janet Novelia' then 'fp-2311 Janet Novelia' 
              when cust_name like 'fp Jesslyn N. Kosasih' then 'fp-2311 Jesslyn N. Kosasih' 
              when cust_name like 'fp Lara Pranata Gianieri' then 'fp-2311 Lara Pranata Gianieri'
              when cust_name like 'fp Latifah hamid' then 'fp-2311 Latifah hamid'
              when cust_name like 'fp Lucia Budidharma' then 'fp-2311 Lucia Budidharma' 
              when cust_name like 'fp Muhammad Ilmansyah' then 'fp-2311 Muhammad Ilmansyah'
              when cust_name like 'fp Nur Fitriana' then 'fp-2311 Nur Fitriana'
              when cust_name like 'fp Reri Rosana Wita' then 'fp-2311 Reri Rosana Wita'
              when cust_name like 'fp Sandy Firmansyah' then 'fp-2311 Sandy Firmansyah'
              when cust_name like 'fp Satriati Tanjung' then 'fp-2311 Satriati Tanjung'
              when cust_name like 'fp Sulistiyaningsih' then 'fp-2311 Sulistiyaningsih' 
              when cust_name like 'fp Susiwaty Chandra' then 'fp-2311 Susiwaty Chandra'
              when cust_name like 'fp Tia Kartikapura' then 'fp-2311 Tia Kartikapura' 
              when cust_name like 'fp Yudith Arianda' then 'fp-2311 Yudith Arianda' 
              when cust_name like 'FP Agus Salim' then 'FP-2311 Agus Salim' 
              when cust_name like 'FP Asmarina Setianingsih' then 'FP-2311 Asmarina Setianingsih'
              when cust_name like 'FP Bayu Aji' then 'FP-2311 Bayu Aji' 
              when cust_name like 'FP Rezza Maulana Fahlevie' then 'FP-2311 Rezza Maulana Fahlevie'
              when cust_name like 'FP Tengku Vannesa Rilviena' then 'FP-2311 Tengku Vannesa Rilviena' 
              when cust_name like 'FP Willy Monika Yohansyah' then 'FP-2311 Willy Monika Yohansyah' 
              when cust_name like 'fp Alberts Hendrajaya' then 'fp-2311 Alberts Hendrajaya'
              when cust_name like 'fp Albertus Andre' then 'fp-2311 Albertus Andre' 
              when cust_name like 'fp Alfonso Riza' then 'fp-2311 Alfonso Riza'
              when cust_name like 'fp Annisa Hamzar' then 'fp-2311 Annisa Hamzar' 
              when cust_name like 'fp Christine Balingit-Ledesma' then 'fp-2311 Christine Balingit-Ledesma'
              when cust_name like 'fp Dian Rahmasari' then 'fp-2311 Dian Rahmasari' 
              when cust_name like 'fp Dimyati Yusuf' then 'fp-2311 Dimyati Yusuf' 
              when cust_name like 'fp Kun Fitriana Mahmudah' then 'fp-2311 Kun Fitriana Mahmudah' 
              when cust_name like 'fp Maria Verita Vita Christiani' then 'fp-2311 Maria Verita Vita Christiani' 
              when cust_name like 'fp Natalia Mulia' then 'fp-2311 Natalia Mulia' 
              when cust_name like 'fp Stacy Samuel' then 'fp-2311 Stacy Samuel'
              when cust_name like 'fp Wynne Lukman' then 'fp-2311 Wynne Lukman'
              when cust_name like 'fp Zaki Makarim' then 'fp-2311 Zaki Makarim'
              when cust_name like 'fp Anggoro Yuniarso' then 'fp-2311 Anggoro Yuniarso' 
              when cust_name like 'fp Arief Budi Santoso' then 'fp-2311 Arief Budi Santoso'
              when cust_name like 'fp Bayu Iman Eryawan' then 'fp-2311 Bayu Iman Eryawan'
              when cust_name like 'fp Bayu Wicaksono' then 'fp-2311 Bayu Wicaksono' 
              when cust_name like 'fp Chairunnisa' then 'fp-2311 Chairunnisa'
              when cust_name like 'fp Cristine Dwi Octaviani' then 'fp-2311 Cristine Dwi Octaviani' 
              when cust_name like 'fp Dedi Darmasah' then 'fp-2311 Dedi Darmasah' 
              when cust_name like 'fp Dewan Ridwan Abdurrazaq' then 'fp-2311 Dewan Ridwan Abdurrazaq'
              when cust_name like 'fp Euis Komalasari' then 'fp-2311 Euis Komalasari'
              when cust_name like 'fp Fika Lestari' then 'fp-2311 Fika Lestari' 
              when cust_name like 'fp Ikhwan Brata Kusuma' then 'fp-2311 Ikhwan Brata Kusuma'
              when cust_name like 'fp Kamino' then 'fp-2311 Kamino'
              when cust_name like 'fp Moh. Andriansyah' then 'fp-2311 Moh. Andriansyah' 
              when cust_name like 'fp Monique Tenggerdjati' then 'fp-2311 Monique Tenggerdjati'
              when cust_name like 'fp RIANSAR B NUGROHO' then 'fp-2311 RIANSAR B NUGROHO'
              when cust_name like 'fp Rangga Fadillah' then 'fp-2311 Rangga Fadillah' 
              when cust_name like 'fp Ribka Suhardi' then 'fp-2311 Ribka Suhardi'
              when cust_name like 'fp Romi Hardian' then 'fp-2311 Romi Hardian'
              when cust_name like 'fp Sri Handayani Kusumastuti' then 'fp-2311 Sri Handayani Kusumastuti'
              when cust_name like 'fp Sri Harini' then 'fp-2311 Sri Harini' 
              when cust_name like 'fp Sudaryani' then 'fp-2311 Sudaryani'
              when cust_name like 'fp Syafriliza Herianda' then 'fp-2311 Syafriliza Herianda' 
              when cust_name like 'fp TUTUR ARIYANTO' then 'fp-2311 TUTUR ARIYANTO' 
              when cust_name like 'fp Wisnu Wardana' then 'fp-2311 Wisnu Wardana'
              when cust_name like 'fp amelia' then 'fp-2311 amelia'
              when cust_name like 'fp aukaria rahman' then 'fp-2311 aukaria rahman'
              when cust_name like 'fp Ade Kresna Kemaltaba' then 'fp-2311 Ade Kresna Kemaltaba' 
              when cust_name like 'fp Anisa Nur Bintari' then 'fp-2311 Anisa Nur Bintari'
              when cust_name like 'fp Ansgar Paska Da Lopez' then 'fp-2311 Ansgar Paska Da Lopez' 
              when cust_name like 'fp Apyt Sulystyanto' then 'fp-2311 Apyt Sulystyanto' 
              when cust_name like 'fp Arleen Tarnadjaja Putri' then 'fp-2311 Arleen Tarnadjaja Putri' 
              when cust_name like 'fp Citra Tridewi Azalea' then 'fp-2311 Citra Tridewi Azalea' 
              when cust_name like 'fp Daniel Sebayang' then 'fp-2311 Daniel Sebayang' 
              when cust_name like 'fp Danik Sudarwati' then 'fp-2311 Danik Sudarwati' 
              when cust_name like 'fp Dian Wulandari Nuhraheni' then 'fp-2311 Dian Wulandari Nuhraheni'
              when cust_name like 'fp Femmy Dealiser sitorus,' then 'fp-2311 Femmy Dealiser sitorus,'
              when cust_name like 'fp Guna Hari Shandy' then 'fp-2311 Guna Hari Shandy'
              when cust_name like 'fp Lisa Naftali' then 'fp-2311 Lisa Naftali'
              when cust_name like 'fp Moch Riyadh' then 'fp-2311 Moch Riyadh' 
              when cust_name like 'fp Nesya Aklima Thaibsyah' then 'fp-2311 Nesya Aklima Thaibsyah'
              when cust_name like 'fp Nuraini Naufal' then 'fp-2311 Nuraini Naufal'
              when cust_name like 'fp Riza Helmy' then 'fp-2311 Riza Helmy' 
              when cust_name like 'fp Rospita Dian' then 'fp-2311 Rospita Dian' 
              when cust_name like 'fp Silvy Rivan' then 'fp-2311 Silvy Rivan' 
              when cust_name like 'fp Supomo' then 'fp-2311 Supomo'
              when cust_name like 'fp Vio Araneta' then 'fp-2311 Vio Araneta' 
              when cust_name like 'fp-jd fangqi hermawan' then 'fp-2391 jd fangqi hermawan'
              when cust_name like 'fp Alfin Darwongso' then 'fp-2311 Alfin Darwongso'
              when cust_name like 'fp Anggraeni Setyadewi' then 'fp-2311 Anggraeni Setyadewi'
              when cust_name like 'fp Feggie Mediano' then 'fp-2311 Feggie Mediano' 
              when cust_name like 'fp Maria Fatma Nuraini' then 'fp-2311 Maria Fatma Nuraini'
              when cust_name like 'fp Marieska M Sebastian' then 'fp-2311 Marieska M Sebastian' 
              when cust_name like 'fp Mohammad Hamami' then 'fp-2311 Mohammad Hamami' 
              when cust_name like 'fp Mutia Sayekti' then 'fp-2311 Mutia Sayekti' 
              when cust_name like 'fp Olivia Wahyuningrum' then 'fp-2311 Olivia Wahyuningrum'
              when cust_name like 'fp Prima Wikaningtyas' then 'fp-2311 Prima Wikaningtyas' 
              when cust_name like 'fp Sadiqin Yasin' then 'fp-2311 Sadiqin Yasin'
              when cust_name like 'fp Syeni Noviardy' then 'fp-2311 Syeni Noviardy'
              when cust_name like 'fp Uray camila Insani' then 'fp-2311 Uray camila Insani'
              when cust_name like 'fp Yulia Sari' then 'fp-2311 Yulia Sari' 
              when cust_name like 'fp-jd ami' then 'fp-2391 jd ami' 
              when cust_name like 'fp Afrida Krishartanto' then 'fp-2311 Afrida Krishartanto' 
              when cust_name like 'fp Andy Ekayudha' then 'fp-2311 Andy Ekayudha'
              when cust_name like 'fp Cucup Koswara' then 'fp-2311 Cucup Koswara' 
              when cust_name like 'fp Elfrida Heriawan' then 'fp-2311 Elfrida Heriawan' 
              when cust_name like 'fp Jovita Arianti' then 'fp-2311 Jovita Arianti' 
              when cust_name like 'fp M Hasyrul Soleh' then 'fp-2311 M Hasyrul Soleh'
              when cust_name like 'fp-jd nuvai' then 'fp-2391 jd nuvai'
              when cust_name like 'fp-jd kharisma yusuf barus' then 'fp-2391 jd kharisma yusuf barus'
              when cust_name like 'fp-jd Claudia Centurini' then 'fp-2391 jd Claudia Centurini'
              when cust_name like 'fp-jd nanang fahrudi' then 'fp-2391 jd nanang fahrudi' 
              when cust_name like 'fp-jd yosep supriatna' then 'fp-2391 jd yosep supriatna'
              when cust_name like 'fp-jd yovica sagina' then 'fp-2391 jd yovica sagina'
              when cust_name like 'fp-2232 PT lifepal technologies' then 'fp-2322 PT lifepal technologies'
              when cust_name like 'fp-2247 pusat gadai emas' then 'fp-2287 pusat gadai emas'
              when cust_name like 'fp gema graha sarana' then 'fp-2379 gema graha sarana'
              when cust_name like 'fp Andri Aulia' then 'fp-2311 Andri Aulia'
              when cust_name like 'FP Susy Tri Lomorti Simanullang' then 'FP-2311 Susy Tri Lomorti Simanullang'
              when cust_name like 'FP Revina Rizky Angelia' then 'FP-2311 Revina Rizky Angelia'
              when cust_name like 'FP Flokq' then 'FP-2077 Flokq'
              when cust_name like 'fp-2216 Rizka' then 'fp-2203 Rizka'
              when cust_name like 'fp-2777 feryanthi putria' then 'fp-2277 feryanthi putri'
              when cust_name like 'FP Gema Graha Sarana' then 'FP-2367 Gema Graha Sarana'
              when cust_name like 'Alief Akbar' then 'fp-2438 Alief Akbar'
              when cust_name like 'fp-2270 syifa' then 'fp-2279 syifa'
              when cust_name like 'fp-2343 febriana' then 'fp-2342 febriana'
              when cust_name like 'fp-2286 andry' then 'fp-2258 andry'
              when cust_name like 'fp-2931 neri' then 'fp-2391 neri'
              when cust_name like 'fp Yohanna' then 'fp-2311 Yohanna'
              when cust_name like 'FP Dewi Sinaga' then 'FP-2311 Dewi Sinaga'
              when cust_name like 'fp-2777 feryanthi putri' then 'fp-2277 feryanthi putri'
              when cust_name like 'JD.ID JD.ID' then 'fp-2391 JD.ID JD.ID'
            else cust_name end as cust_name
, min(trans_date) as project_date
from getpbf
group by cust_name
)

, finalkey as
( 
select *
, ROW_NUMBER() OVER(partition BY trans_date, cust_key, cust_name, nmv, cogs, increment_id, sku, GMV) AS Row_Number
from key
)
 
, final as 
(
select c.trans_date
, c.increment_id 
, c.sku
, round (c.nmv, 0) nmv
, round (c.gmv, 0) gmv 
, round (c.cost_price,0) cost_price
, round (c.price_per_item, 0) price_per_item
, c.qty_ordered
, round (c.cogs, 0) cogs
, c.cust_name
, SAFE_CAST(c.cust_key as INT64) cust_key
, c.customer_city 
, c.customer_subdistrict
, c.customer_village
, b.project_date
, case when a.NPS_status is null then 'Blanks'
       else a.NPS_status
       end as NPS_status
, case when a.Contractor is null then '!#N/A'
       else a.Contractor
       end as Contractor
, case when c.cust_name="pbf-715 irwan" then 'Residential'
       when c.cust_name="Fitriyani Rezeki" then 'Residential'
       when c.cust_name="pbf-218 roommie" then 'Corporate'
       when c.cust_name="hbf-1675" then 'Residential'
       when c.cust_name="FP-2071 Samsung" then 'Corporate'
       when c.cust_name="fp PT HDG BRANDING TECHNOLOGY" then 'Corporate'
       when c.cust_name="FP Barito" then 'Corporate'
       when c.cust_name="FP Panglima Polim" then 'Corporate'
       when c.cust_name="PBF-1860 Elisabeth Lino" then 'Retail'
       when d.CATEGORYFIX is null then '!#N/A'
       when d.CATEGORYFIX ='Individual' then 'Residential'       
       else d.CATEGORYFIX
       end as Category
, case when lower(c.sku) NOT Like "%work%" 
              and lower(c.sku) NOT Like "%works%" 
              and lower(c.sku) NOT Like "%custom%" 
              and lower(c.sku) NOT Like "%voucherfp-2287%" 
              and lower(c.sku) NOT Like "%electronics%" 
              and lower(c.sku) NOT Like "%electronincs%" 
              and lower(c.sku) NOT Like "%mepfp%" 
              and lower(c.sku) NOT Like "%mep%" 
              and lower(c.sku) NOT Like "%custombarstoolsmsg%" 
              and lower(c.sku) NOT Like "%chair%" 
              and lower(c.sku) NOT Like "%mepfp-2139%" 
              and lower(c.sku) NOT Like "%kitchen%" then 'Loose Furniture'
       when lower(c.sku) like "%mep%" 
              or lower(c.sku) like "%custom civil%" 
              or lower(c.sku) like "%hypefast%" 
              or lower(c.sku) like "%voucherfp-2287%" 
              or lower(c.sku) like "%work%" then 'Civil Work'
      when lower(c.sku) like "%custom%" 
              or lower(c.sku) like "%chair%" 
              or lower(c.sku) like "%kitchen set%" 
              and lower(c.sku) NOT Like "%civil%"  then 'Custom Furniture'
       when lower(c.sku) like "%electronics%" 
              or lower(c.sku) like "%electronincs%" then 'Electronic and Accesories'
       else ''
       end as Services
, case when d.SUB_CATEGORY is null then '!#N/A'
       else d.SUB_CATEGORY
       end as Sub_Category_
, round((c.nmv - c.cogs) / c.nmv, 2) Margin
, case when c.cust_name="hbf-1675" then 'Procurement'
       when c.cust_name="FP-2071 Samsung" then 'Procurement' 
       when c.cust_key ='2311' then 'Procurement'
       when c.cust_key ='2391' then 'Procurement'
       else a.Type_of_Projects
       end Type_of_Projects
, d.source_channel
, ROW_NUMBER() OVER(partition BY c.trans_date, c.cust_key, c.cust_name, c.nmv, c.cogs, c.product_type, c.increment_id, c.sku, c.gmv) AS Row_Number
from finalkey c
left join project b on c.cust_name=b.cust_name
left join `fabelio-bi.pbf_data.pbf_pipeline_master_2` a on c.cust_key=a.key and c.row_number=1
left join `fabelio-bi.pbf_data.view_unionall_warmleads` d on c.cust_key=d.key and c.row_number=1
--left join `fabelio-bi.pbf_data.vw_quotation_master` e on  c.cust_key=e.Key and c.row_number=1
--where trans_date >= '2020-01-01'
order by c.trans_date
)

, revenue as (
select 
  * 
  , case when source_channel in ('CS & CEM - Call', 'CS & CEM - Email', 'CS & CEM - Whatsapp', 'CS & CEM - Zopim', 'CEM - Whatsapp') then 'Virtual Assistant'
    when source_channel in ('Partnership', 'Event') then 'Partnership & Event'
    when source_channel in ('Private Network', 'Private network', 'Returning Customer') then 'Private Network & Returning Customer'
    when source_channel like '%Showroom%' then 'Showroom'
    when source_channel like 'FPES' then 'FPES'
    when source_channel in ('Website Leads', 'Instagram Ads', 'Inbound - WA') then 'Web, Inbound WA & Instagram Ads'
    else ''
    end as lead_source_mapping from final where row_number=1
)

select * from revenue
)